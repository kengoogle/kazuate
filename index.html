import React, { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Alert, AlertDescription } from '@/components/ui/alert';

const NumberGuessingGame = () => {
  const [targetNumber, setTargetNumber] = useState(0);
  const [guess, setGuess] = useState('');
  const [message, setMessage] = useState('');
  const [attempts, setAttempts] = useState(0);
  const [imageLoaded, setImageLoaded] = useState(false);

  useEffect(() => {
    generateNewNumber();
  }, []);

  const generateNewNumber = () => {
    setTargetNumber(Math.floor(Math.random() * 100) + 1);
    setMessage('');
    setAttempts(0);
  };

  const handleGuess = () => {
    const guessNumber = parseInt(guess);
    setAttempts(attempts + 1);

    if (isNaN(guessNumber)) {
      setMessage('有効な数字を入力してください。');
    } else if (guessNumber === targetNumber) {
      setMessage(`正解です！${attempts + 1}回で当てました。`);
    } else if (guessNumber < targetNumber) {
      setMessage('もっと大きい数字です。');
    } else {
      setMessage('もっと小さい数字です。');
    }

    setGuess('');
  };

  const handleImageError = () => {
    console.error('画像の読み込みに失敗しました');
    setImageLoaded(false);
  };

  const handleImageLoad = () => {
    setImageLoaded(true);
  };

  return (
    <div className="p-4 max-w-md mx-auto">
      <h1 className="text-2xl font-bold mb-4">数当てゲーム</h1>
      {imageLoaded ? (
        <img 
          src="https://live.staticflickr.com/65535/53849007531_22c3a6599f_n.jpg" 
          alt="ゲームイメージ" 
          className="w-full mb-4 rounded-lg shadow-md"
          onError={handleImageError}
          onLoad={handleImageLoad}
        />
      ) : (
        <div className="w-full h-48 bg-gray-200 flex items-center justify-center mb-4 rounded-lg">
          <p>画像を読み込めません</p>
        </div>
      )}
      <p className="mb-2">1から100の間の数字を当ててください。</p>
      <div className="flex mb-4">
        <Input
          type="number"
          value={guess}
          onChange={(e) => setGuess(e.target.value)}
          placeholder="数字を入力"
          className="mr-2"
        />
        <Button onClick={handleGuess}>予想する</Button>
      </div>
      {message && (
        <Alert className="mb-4">
          <AlertDescription>{message}</AlertDescription>
        </Alert>
      )}
      <Button onClick={generateNewNumber}>新しいゲームを始める</Button>
    </div>
  );
};

export default NumberGuessingGame;